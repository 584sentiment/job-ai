<!--pages/job-detail/job-detail.wxml-->
<view class="container">
  <scroll-view class="main-content" scroll-with-animation scroll-y>
    <!-- åŸºç¡€ä¿¡æ¯å¡ç‰‡ -->
    <view class="card">
      <view class="detail-header">
        <view class="company-info">
          <text class="company-name">{{job.company}}</text>
          <text class="position-name">{{job.position}}</text>
        </view>
        <view class="status-badge status-{{job.status}}">{{job.statusText}}</view>
      </view>
      <view class="detail-grid">
        <view class="detail-item">
          <text class="detail-label">åœ°ç‚¹</text>
          <text class="detail-value">{{job.location}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">è–ªèµ„</text>
          <text class="detail-value">{{job.salary}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ¸ é“</text>
          <text class="detail-value">{{job.channel}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ—¥æœŸ</text>
          <text class="detail-value">{{job.applyDate}}</text>
        </view>
      </view>
    </view>

    <!-- AIåŒ¹é…åº¦åˆ†æå¡ç‰‡ -->
    <view class="ai-card" wx:if="{{job.aiMatchScore}}">
      <view class="ai-header">
        <text class="ai-icon">ğŸ¯</text>
        <text class="ai-title">AI å²—ä½åŒ¹é…åº¦åˆ†æ</text>
      </view>

      <!-- å››ç»´åº¦è¯„åˆ† -->
      <view class="match-scores">
        <view class="match-score-item">
          <text class="match-score-label">æŠ€èƒ½</text>
          <text
            class="match-score-value {{job.aiMatchScore.skills >= 80 ? 'high' : 'medium'}}">{{job.aiMatchScore.skills}}%</text>
        </view>
        <view class="match-score-item">
          <text class="match-score-label">ç»éªŒ</text>
          <text
            class="match-score-value {{job.aiMatchScore.experience >= 80 ? 'high' : 'medium'}}">{{job.aiMatchScore.experience}}%</text>
        </view>
        <view class="match-score-item">
          <text class="match-score-label">å­¦å†</text>
          <text class="match-score-value high">{{job.aiMatchScore.education}}%</text>
        </view>
        <view class="match-score-item">
          <text class="match-score-label">è–ªèµ„</text>
          <text
            class="match-score-value {{job.aiMatchScore.salary >= 80 ? 'high' : job.aiMatchScore.salary >= 60 ? 'medium' : 'low'}}">{{job.aiMatchScore.salary}}%</text>
        </view>
      </view>

      <!-- æ€»ä½“åŒ¹é…åº¦ -->
      <view class="overall-match">
        <view class="overall-header">
          <text class="overall-label">æ€»ä½“åŒ¹é…åº¦</text>
          <text class="overall-value">{{job.aiMatchScore.overall}}%</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{job.aiMatchScore.overall}}%"></view>
        </view>
      </view>

      <!-- ä¼˜åŠ¿ä¸å»ºè®® -->
      <view class="match-analysis">
        <view class="analysis-item" wx:for="{{job.aiMatchScore.advantages}}" wx:key="index">
          <text class="analysis-icon success">âœ…</text>
          <text class="analysis-text">ä¼˜åŠ¿ï¼š{{item}}</text>
        </view>
        <view class="analysis-item" wx:for="{{job.aiMatchScore.suggestions}}" wx:for-item="suggestion" wx:key="*this">
          <text class="analysis-icon warning">âš ï¸</text>
          <text class="analysis-text">å»ºè®®ï¼š{{suggestion}}</text>
        </view>
      </view>
    </view>

    <!-- è¿›åº¦æ—¶é—´çº¿ -->
    <view class="card">
      <view class="section-title">è¿›åº¦æ—¶é—´çº¿</view>
      <view class="timeline" wx:if="{{job.timeline && job.timeline.length > 0}}">
        <view class="timeline-item" wx:for="{{job.timeline}}" wx:key="date">
          <view class="timeline-dot"></view>
          <view class="timeline-content">
            <text class="timeline-status">{{item.status}}</text>
            <text class="timeline-date">{{item.date}} {{item.desc ? '- ' + item.desc : ''}}</text>
          </view>
        </view>
      </view>
      <view class="empty-timeline" wx:else>
        <text class="empty-text">æš‚æ— è¿›åº¦è®°å½•</text>
      </view>
    </view>

    <!-- JDå†…å®¹ -->
    <view class="card" wx:if="{{job.jd}}">
      <view class="section-title">å²—ä½JD</view>
      <text class="jd-content">{{job.jd}}</text>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="bottom-actions">
      <button class="btn btn-danger" bindtap="onDelete">åˆ é™¤</button>
      <button class="btn btn-secondary" bindtap="onEdit">ç¼–è¾‘</button>
      <button class="btn btn-primary" bindtap="onAddInterview">æ·»åŠ é¢è¯•</button>
    </view>
  </scroll-view>
</view>